const t=function(t){return t.children=t.children||[],t._cache=t._cache||{},t.props=t.props||{},t._cache.parents=t._cache.parents||[],t},e=/^ *(#|\/\/)/,n=function(e){let n=e.trim().split(/->/),r=[];n.forEach((e=>{r=r.concat(function(e){if(!(e=e.trim()))return null;if(/^\[/.test(e)&&/\]$/.test(e)){let n=(e=(e=e.replace(/^\[/,"")).replace(/\]$/,"")).split(/,/);return n=n.map((t=>t.trim())).filter((t=>t)),n=n.map((e=>t({id:e}))),n}return[t({id:e})]}(e))})),r=r.filter((t=>t));let i=r[0];for(let t=1;t<r.length;t+=1)i.children.push(r[t]),i=r[t];return r[0]},r=t=>{let e=[],n=[t];for(;n.length>0;){let t=n.pop();e.push(t),t.children&&t.children.forEach((t=>{n.push(t)}))}return e},i=function(i=[]){return"string"==typeof i?function(r){let i=r.split(/\r?\n/),o=[];i.forEach((t=>{if(!t.trim()||e.test(t))return;let r=(t=>{const e=/^(  |\t)/;let n=0;for(;e.test(t);)t=t.replace(e,""),n+=1;return n})(t);o.push({indent:r,node:n(t)})}));let s=function(t){let e={children:[]};return t.forEach(((n,r)=>{0===n.indent?e.children=e.children.concat(n.node):t[r-1]&&function(t,e){let n=t[e].indent;for(;e>=0;e-=1)if(t[e].indent<n)return t[e];return t[0]}(t,r).node.children.push(n.node)})),e}(o);return s=t(s),s}(i):(o=i,"[object Array]"===Object.prototype.toString.call(o)?function(e){let n={};e.forEach((t=>{n[t.id]=t}));let r=t({});return e.forEach((e=>{if((e=t(e)).parent)if(n.hasOwnProperty(e.parent)){let t=n[e.parent];delete e.parent,t.children.push(e)}else console.warn(`[Grad] - missing node '${e.parent}'`);else r.children.push(e)})),r}(i):(r(s=i).forEach(t),s));var o,s},o=t=>"[31m"+t+"[0m",s=t=>"[2m"+t+"[0m",c=function(t,e){let n="-> ";e&&(n=s("â†’ "));let i="";return r(t).forEach(((t,r)=>{let s=t.id||"";if(e&&(s=o(s)),0===r&&!t.id)return;let c=t._cache.parents.length;i+="    ".repeat(c)+n+s+"\n"})),i},l=function(t){let e=r(t);e.forEach((t=>{delete(t=Object.assign({},t)).children}));let n=e[0];return n&&!n.id&&0===Object.keys(n.props).length&&e.shift(),e},h={text:c,txt:c,array:l,flat:l},u={nested:!0,json:!0},p=function(t,e="ascii"){return u.hasOwnProperty(e)?t:"debug"===e?(console.log(c(t,!0)),null):h.hasOwnProperty(e)?h[e](t):t};function a(t={},e={}){return Object.keys(e).forEach((n=>{if(e[n]instanceof Set){let r=t[n]||new Set;t[n]=new Set([...r,...e[n]])}else{if(function(t){return t&&"object"==typeof t&&!Array.isArray(t)}(e[n])){let r=t[n]||{};t[n]=Object.assign({},e[n],r)}else if(r=e[n],"[object Array]"!==Object.prototype.toString.call(r)){var r;void 0===t[n]&&(t[n]=e[n])}else{let r=t[n]||[];t[n]=e[n].concat(r)}}})),t}const f=/\//;class d{constructor(t={}){(t=>{let e=[],n=[t];for(;n.length>0;){let t=n.pop();e.push(t),t.children&&t.children.forEach((e=>{t.id&&(t._cache.parents=t._cache.parents||[],e._cache.parents=t._cache.parents.concat([t.id])),n.push(e)}))}})(t),Object.defineProperty(this,"json",{enumerable:!1,value:t,writable:!0})}get children(){return this.json.children}get id(){return this.json.id}get found(){return this.json.id||this.children.length>0}props(t={}){let e=this.json.props||{};return"string"==typeof t&&(e[t]=!0),this.json.props=Object.assign(e,t),this}get(e){if(e=(e||"").trim(),!f.test(e)){let t=this.children.find((t=>t.id===e));return new d(t)}let n=function(t,e){let n=function(t){return"string"!=typeof(t=t||"")?t:(t=t.replace(/^\//,"")).split(/\//)}(e);for(let e=0;e<n.length;e+=1){let r=t.children.find((t=>t.id===n[e]));if(!r)return null;t=r}return t}(this.json,e)||t({});return new d(n)}nodes(){return r(this.json)}cache(){return r(this.json),this}list(){return r(this.json)}fillDown(){return(t=>{let e=[],n=[t];for(;n.length>0;){let t=n.pop();e.push(t),t.children.forEach((e=>{e.props=a(e.props,t.props),n.push(e)}))}})(this.json),this}out(t){return p(this.json,t)}debug(){return p(this.json,"debug"),this}}const g=function(t){let e=i(t);return new d(e)};g.prototype.plugin=function(t){t(this)};export{g as default};
