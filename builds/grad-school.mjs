const t=/^ *(#|\/\/)/,e=function(t){let e=t.trim().split(/->/),n=[];e.forEach((t=>{n=n.concat(function(t){if(!(t=t.trim()))return null;if(/^\[/.test(t)&&/\]$/.test(t)){let e=(t=(t=t.replace(/^\[/,"")).replace(/\]$/,"")).split(/,/);return e=e.map((t=>t.trim())).filter((t=>t)),e=e.map((t=>({label:t,children:[]}))),e}return[{label:t,children:[]}]}(t))})),n=n.filter((t=>t));let r=n[0];for(let t=1;t<n.length;t+=1)r.children.push(n[t]),r=n[t];return n[0]},n=function(t){let{width:e}={width:process.stdout.columns,height:process.stdout.rows},n=function(t){let e=0,n=0;const r=function(t,l,i){l>e&&(e=l),i>n&&(n=i),t.children&&t.children.forEach(((t,e)=>{r(t,l+e,i+1)}))};return r(t,0,0),{depth:n,breadth:e}}(t);return n.width=e,n},r={ascii:function(t){let{width:e,depth:r,breadth:l}=n(t),i=function(t){let e=[];const n=function(t,r,l,i){t.x=r,t.y=l,t.size=i,e[l]=e[l]||[],e[l].push(t);let o=Math.floor(i/(t.children.length||1));t.children.forEach(((t,e)=>{n(t,r+e*o,l+1,o)}))};return n(t,0,0,100),e}(t),o=[];return i.forEach((t=>{let n=Math.floor(e/t.length),r="";t.forEach((t=>{r+=((t="",e)=>{e-=3;let n=Math.floor(e/2),r=Math.floor(t.length/2),l="".padEnd(n-r,"_");return` ${l}${t}${l} `})(t.label,n)})),o.push(r)})),o.join("\n")}},l=/\//;class i{constructor(t={}){Object.defineProperty(this,"json",{enumerable:!1,value:t,writable:!0})}get children(){return this.json.children}get label(){return this.json.label}get props(){return this.json.props||{}}set props(t){this.json.props=this.json.props||{};let e=this.json.props;"string"==typeof t&&(e[t]=!0),Object.assign(e,t)}get(t){if(t=(t||"").trim(),!l.test(t)){let e=this.children.find((e=>e.label===t));return new i(e)}let e=function(t,e){let n=function(t){return"string"!=typeof(t=t||"")?t:(t=t.replace(/^\//,"")).split(/\//)}(e);for(let e=0;e<n.length;e+=1){let r=t.children.find((t=>t.label===n[e]));if(!r)return null;t=r}return t}(this,t);return new i(e)}list(){return(t=>{let e=[],n=[t];for(;n.length>0;){let t=n.pop();e.push(t),t.children.forEach((t=>n.push(t)))}return e})(this.json)}fillDown(){return function(t){let e=t.props||{};const n=t=>{e=Object.assign({},e,t.props),t.props=e,t.children.forEach(n)};n(t)}(this.json),this}out(){return function(t,e="ascii"){return r.hasOwnProperty(e)?r[e](t):r.ascii(t)}(this.json)}}export default function(n){let r={};return r="string"==typeof n?function(n){let r=n.split(/\r?\n/),l=[];return r.forEach((n=>{if(!n.trim()||t.test(n))return;let r=(t=>{const e=/^(  |\t)/;let n=0;for(;e.test(t);)t=t.replace(e,""),n+=1;return n})(n);l.push({indent:r,node:e(n)})})),function(t){let e={children:[]};return t.forEach(((n,r)=>{0===n.indent?e.children=e.children.concat(n.node):t[r-1]&&t[r-1].node.children.push(n.node)})),e}(l)}(n):n||r,new i(r)}
